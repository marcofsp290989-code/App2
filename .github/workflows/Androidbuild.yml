name: Build APK

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Dar permissão ao gradlew
        run: chmod +x ./gradlew

      - name: Configurar JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      # Esse passo é o mais importante agora
      - name: Fazer build completo com log detalhado
        run: |
          ./gradlew clean assembleDebug --stacktrace --info || echo "BUILD FALHOU - ver log acima"

      # Mostra tudo que tem na pasta build (pra gente ver o que realmente foi gerado)
      - name: Listar tudo que foi gerado na pasta build
        run: |
          echo "=== Conteúdo da pasta app/build/outputs ==="
          ls -la app/build/outputs/ || echo "Pasta não existe ainda"
          echo "=== Conteúdo da pasta build/outputs de todos os módulos ==="
          find . -path "*/build/outputs" -type d || echo "Nenhum outputs encontrado"
          echo "=== Procurando qualquer .apk no projeto inteiro ==="
          find . -name "*.apk" -type f || echo "NENHUM .apk GERADO"

      # Upload só se existir algum APK (nunca mais vai dar warning amarelo)
      - name: Upload APK (se existir)
        uses: actions/upload-artifact@v4
        if: success()
        with:
          name: APK-Gerado
          path: |
            */.apk
          retention-days: 30
